name: 'eks-$(Date:yyyy-MM-dd)$(Rev:.r)'

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - azure-pipelines/eks.yml

pool:
  name: 'Local'

variables:
  - name: projectRoot
    value: $(System.DefaultWorkingDirectory)

stages:
  - stage: EchoJobRoot
    displayName: Show job root
    jobs:
      - job: Deploy
        workspace:
          clean: all
        displayName: Deploy Application
        steps:
        
        # - task: Bash@3
          # displayName: 'Install AWS CLI'
          # inputs:
            # script: |
              # curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
              # unzip awscli-bundle.zip
              # sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws
        
        - task: Bash@3
          displayName: 'Debug â€” Show working dir'        
          inputs:
            targetType: inline
            script: |
              echo 'Working directory from variables: $(projectRoot)'
              ls -lh /usr/local/bin/aws
              aws --version
        
        - task: AWSCLI@1
          displayName: 'AWSCLI@1 version check'
          inputs:
            awsCommand: aws
            awsSubCommand: --version