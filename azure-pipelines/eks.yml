name: 'eks-$(Date:yyyy-MM-dd)$(Rev:.r)'

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - azure-pipelines/eks.yml
      - azure-pipelines/templates/aws/stages/*

pool:
  name: 'Local'

variables:
  - name: installAWS
    value: true

  - name: projectRoot
    value: $(System.DefaultWorkingDirectory)

  - name: awsCredentials
    value: aws-oidc-federation

  - name: regionName
    value: us-east-1 

stages:
  - template: ./templates/aws/stages/install-aws.yml
    parameters:
      stageName: InstallAWSCLIv1
      installAWS: ${{ variables.installAWS }}
      awsCredentials: $(awsCredentials)

  - template: ./templates/aws/stages/delete-aws.yml 
    parameters:
      dependsOn: InstallAWSCLIv1
      stageName: DeleteAWSCLIv1