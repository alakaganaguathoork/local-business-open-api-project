name: 'eks-$(Date:yyyy-MM-dd)$(Rev:.r)'

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - azure-pipelines/eks.yml

pool:
  name: 'Local'

variables:
  - name: projectRoot
    value: $(System.DefaultWorkingDirectory)
  - name: awsConnector
    value: aws-oidc-federation
  - name: awsRegionName
    value: us-east-1 

stages:
  - stage: Install
    displayName: Install AWS and check identity
    jobs:
      - template: ./templates/aws/job/install-aws.yml
        parameters:
          install: true
          awsCredentials: $(awsConnector)

      - template: ./templates/aws/job/delete-aws.yml
        parameters:
          dependsOn: job.installAWS