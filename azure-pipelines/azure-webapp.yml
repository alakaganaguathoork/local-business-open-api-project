name: 'app-$(Date:yyyy-MM-dd)$(Rev:.r)'

trigger:
  branches:
    include:
    - azure-pipeline
  paths:
    include:
    - app/*
    - azure-pipelines/azure-webapp.yml

variables:
  azureServiceConnectorId: azure-connector

pool:
  name: Local

stages:
  - stage: Build
    variables:
    - group: Main
    jobs:
    - job: CreateEnvFile
      steps:
      
      - template: templates/get-app-service-data.yml

      - template: templates/deploy-webapp-template.yml
        parameters:
          apps: $[ dependencies.BuildAndDeployApps.outputs['GetAppNames.apps'] ]