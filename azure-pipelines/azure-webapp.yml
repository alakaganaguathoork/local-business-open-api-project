trigger:
  branches:
    include:
      - azure-pipeline

variables:
  azureServiceConnectorId: "7a9cf0e8-68d1-4cdc-82c7-d96cca6b8858"
  appName: "app-1"
  appType: "webAppLinux"
  resourceGroupName: "resource-group-test"
  pythonVersion: "3.12"

pool:
  name: Local

stages:
  - stage: Deploy
    displayName: Deploy
    jobs:
      - job: DeployApp
        steps: 
        - script: |
              python3 -m venv env
              source env/bin/activate
              pip install --no-cache-dir -r app/requirements.txt
          displayName: "Install dependencies"
        
        - task: AzureWebApp@1
          inputs:
            azureSubscription: "$(azureServiceConnectorId)"
            appName: "$(appName)"
            appType: webAppLinux
            resourceGroupName: "$(resourceGroupName)"
            package: "$(System.DefaultWorkingDirectory)"
            runtimeStack: "PYTHON:3.12"
            startUpCommand: "python3 app/app.py"
          displayName: "Deploy to Azure App Service"

